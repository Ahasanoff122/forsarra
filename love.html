<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8" />
<title>Romantik Ürək + 3D Döyünmə + Axan Ulduzlar</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<style>
  html, body {
    margin: 0; padding: 0;
    height: 100vh; width: 100vw;
    overflow: hidden;
    background: linear-gradient(135deg, #1b2735 0%, #090a0f 100%);
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }
  canvas#stars, canvas#particles {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    display: block;
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    -webkit-touch-callout: none;
  }
  #playBtn {
    position: fixed;
    bottom: 20px; left: 50%;
    transform: translateX(-50%);
    background: rgba(255, 105, 180, 0.85);
    color: white;
    border: none;
    padding: 12px 24px;
    font-size: 16px;
    border-radius: 30px;
    cursor: pointer;
    z-index: 10;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    box-shadow: 0 0 15px rgba(255, 105, 180, 0.7);
    transition: background 0.3s ease;
  }
  #playBtn:hover {
    background: rgba(255, 105, 180, 1);
  }
</style>
</head>
<body>

<canvas id="stars"></canvas>
<canvas id="particles"></canvas>

<button id="playBtn">Musiqini Başlat</button>

<audio id="music" loop preload="auto">
  <source src="audio/I Wanna Be Yours [nyuo9-OjNNg] (mp3cut.net).mp3" type="audio/mpeg" />
  Sizin brauzer audio elementini dəstəkləmir.
</audio>

<script>
  // CANVAS VƏ KONTEKSTLƏR
  const starsCanvas = document.getElementById('stars');
  const starsCtx = starsCanvas.getContext('2d');
  const particlesCanvas = document.getElementById('particles');
  const particlesCtx = particlesCanvas.getContext('2d');

  // ULDUZLAR VƏ HİSSƏCİKLƏRİN SAHƏLƏRİ
  let stars = [];
  let particles = [];
  const numParticles = 400;
  const heartPoints = [];

  // CANVAS ÖLÇÜSÜNÜ DÜZGÜN QURAQ (RETINA DƏSTƏYİ)
  function fixCanvasSize(canvas, ctx) {
    const dpr = window.devicePixelRatio || 1;
    canvas.width = window.innerWidth * dpr;
    canvas.height = window.innerHeight * dpr;
    canvas.style.width = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
    ctx.setTransform(1, 0, 0, 1, 0, 0); // reset transform
    ctx.scale(dpr, dpr);
  }

  // ULDUZLARIN İNİSİALLAŞDIRILMASI
  function initStars() {
    fixCanvasSize(starsCanvas, starsCtx);
    stars = [];
    for(let i = 0; i < 100; i++) {
      stars.push({
        x: Math.random() * window.innerWidth,
        y: Math.random() * window.innerHeight,
        radius: Math.random() * 1.2 + 0.8,
        alpha: 0.8 + Math.random() * 0.2,
        speedY: 0.9 + Math.random() * 3.5,
        twinkleDelta: 0.003 + Math.random() * 0.007,
        twinkleDir: 1
      });
    }
  }

  // ULDUZLARIN ÇİZİLMƏSİ VƏ Hərəkəti
  function drawStars() {
    starsCtx.clearRect(0, 0, starsCanvas.width, starsCanvas.height);
    stars.forEach(star => {
      star.y += star.speedY;
      if(star.y > window.innerHeight) star.y = 0;

      star.alpha += star.twinkleDelta * star.twinkleDir;
      if(star.alpha >= 1 || star.alpha <= 0.7) star.twinkleDir *= -1;

      starsCtx.beginPath();
      starsCtx.arc(star.x, star.y, star.radius, 0, Math.PI*2);
      starsCtx.fillStyle = `rgba(255, 255, 255, ${star.alpha})`;
      starsCtx.shadowColor = `rgba(255, 255, 255, ${star.alpha})`;
      starsCtx.shadowBlur = 6;
      starsCtx.fill();
    });
  }

  // ÜRƏK FORMASI ÜÇÜN NÖQTƏLƏRİN HESABLANMASI (MATEMATİK FORMULA)
  function getHeartPoints() {
    const points = [];
    const scale = 8;
    for (let t = 0; t < Math.PI * 2; t += 0.06) {
      const x = 16 * Math.pow(Math.sin(t), 3);
      const y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));
      points.push({ x: x * scale, y: y * scale });
    }
    return points;
  }
  heartPoints.push(...getHeartPoints());

  // 3D DÖYÜNMƏ ÜÇÜN PARAMETRLƏR
  const rotationRadius = 11; // Döyünmə radiusu
  let rotationAngle = 3; // Döyünmə açısı

  // HİSSƏCİK SINIFI
  class Particle {
    constructor(x, y) {
      this.baseX = x; // əsas mövqe (ürək nöqtəsi)
      this.baseY = y;
      this.x = Math.random() * window.innerWidth;
      this.y = Math.random() * window.innerHeight;
      this.dest = { x, y };
      this.baseRadius = 1.5;
      this.r = this.baseRadius;
      this.vx = (Math.random() - 0.5) * 10;
      this.vy = (Math.random() - 0.5) * 10;
      this.accX = 0;
      this.accY = 0;
      this.friction = 0.85;
      this.speedFactor = 0.0035;  // Yığılma sürəti

      this.phase = 0;
      this.pulseScale = 2.5;
      this.hue = 320;
    }

    render() {
      if (this.phase < 1) {
        // Yığılma mərhələsi: hissəciklər mərkəzə doğru hərəkət edir
        this.accX = (this.dest.x - this.x) * this.speedFactor;
        this.accY = (this.dest.y - this.y) * this.speedFactor;
        this.vx += this.accX;
        this.vy += this.accY;
        this.vx *= this.friction;
        this.vy *= this.friction;
        this.x += this.vx;
        this.y += this.vy;
        this.r = this.baseRadius;
      } else if (this.phase < 2) {
        // Döyünmə və pulse mərhələsi
        const pulseDuration = 2000;
        const time = (Date.now() % pulseDuration) / pulseDuration;

        rotationAngle += 0.075; // Döyünmə sürəti

        // Z oxu üzrə 3D effekt (hissəciklər önə və geriyə gəlir)
        const z = Math.sin(rotationAngle * 3 + this.baseX * 0.01);
        const scale3d = 1 + 0.6 * z;  // Böyüyüb kiçilmə effekti

        // 2D döyünmə koordinatları
        this.x = this.baseX + Math.cos(rotationAngle + this.dest.x) * rotationRadius;
        this.y = this.baseY + Math.sin(rotationAngle + this.dest.y) * rotationRadius;

        // Pulse + 3D efektin birlikdə radiusa təsiri
        this.pulseScale = (1 + 0.5 * Math.sin(time * 2 * Math.PI)) * scale3d;
        this.r = this.baseRadius * this.pulseScale;

        // Rəngin zamanla dəyişməsi
        this.hue = 320 + 360 * Math.sin(time * 2 * Math.PI);
      } else {
        this.phase = 0; // Döyünmə dövrü təkrarlanır
      }

      this.phase += 0.005; // Faz keçidinin sürəti

      // Hissəcikin çəkilməsi
      particlesCtx.beginPath();
      particlesCtx.fillStyle = `hsla(${this.hue}, 80%, 70%, 0.9)`;
      particlesCtx.shadowColor = `hsla(${this.hue}, 80%, 70%, 0.7)`;
      particlesCtx.shadowBlur = 12;
      particlesCtx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
      particlesCtx.fill();
    }
  }

  // HİSSƏCİKLƏRİN İNİSİALLAŞDIRILMASI
  function initParticles() {
    particles = [];
    const offsetX = window.innerWidth / 2;
    const offsetY = window.innerHeight / 2;
    for (let i = 0; i < numParticles; i++) {
      const p = heartPoints[i % heartPoints.length];
      particles.push(new Particle(p.x + offsetX, p.y + offsetY));
    }
  }

  // ANİMASİYA DÖNGÜSÜ
  function animate() {
    particlesCtx.clearRect(0, 0, particlesCanvas.width, particlesCanvas.height);
    drawStars();

    for (let i = 0; i < particles.length; i++) {
      particles[i].render();
    }

    requestAnimationFrame(animate);
  }

  // EKRAN ÖLÇÜSÜ DƏYİŞƏNDƏ CANVAS-ın YENİDƏN TƏYİN EDİLMƏSİ
  function resize() {
    fixCanvasSize(starsCanvas, starsCtx);
    fixCanvasSize(particlesCanvas, particlesCtx);
  }

  // MUSİQİNİN İDARƏ EDİLMƏSİ
  const music = document.getElementById('music');
  const playBtn = document.getElementById('playBtn');

  playBtn.addEventListener('click', () => {
    if (music.paused) {
      music.play();
      playBtn.textContent = "Musiqini Dayandır";
    } else {
      music.pause();
      playBtn.textContent = "Musiqini Başlat";
    }
  });

  // Pəncərə ölçüsü dəyişdikdə uyğunlaşma
  window.addEventListener('resize', () => {
    resize();
    initStars();
    initParticles();
  });

  // Səhifə yüklənəndə başlat
  window.addEventListener('load', () => {
    resize();
    initStars();
    initParticles();
    animate();
  });
</script>

</body>
</html>
